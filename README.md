# Attention 任务提醒工具

Attention 是一个基于 Python 与 Tkinter 的桌面悬浮任务提醒应用。它提供系统托盘控制、任务历史记录、外观自定义、时间表锁机，以及中文 / 英文界面切换，帮助你在电脑前保持专注与规律作息。

## 功能亮点

- **悬浮提醒**：窗口始终置顶、背景透明，可拖拽至任意位置。
- **快捷编辑**：双击任务文本即可快速修改，`Esc` 键可最小化到托盘。
- **系统托盘**：菜单支持显示/隐藏、开始任务、暂停/继续、终止、编辑设置与查看历史。
- **任务状态颜色**：进行中为红色、暂停为蓝色、终止为白色，状态一目了然。
- **时间跟踪**：在文本下方实时展示开始时间与已持续时长（不足一小时显示分钟，超过一小时显示“X小时Y分”）。
- **外观与语言设置**：支持字体、字号、文字颜色、描边颜色、透明度等个性化配置，并可切换中文或英文。
- **历史记录归档**：自动记录每日任务事件（开始、暂停、继续、终止），可按日期回顾。
- **时间表锁机**：可配置每日时间段（如早餐/午餐/晚餐），到点后自动锁定电脑，帮助养成规律休息习惯。

## 环境要求

- Windows 10 / 11
- Python 3.10 及以上版本

## 安装与运行

```powershell
# 克隆仓库
git clone <repo-url>
cd attention

# 创建并激活虚拟环境（推荐）
python -m venv .venv
.venv\Scripts\activate

# 安装依赖
pip install pystray pillow
# 或依据 pyproject 配置执行 uv / poetry / pip install -r requirements.txt

# 启动应用
python main.py
```

首次运行会在当前目录生成：

- `config.json`：保存窗口位置、任务文本、外观与语言配置。
- `task_history.json`：按日期记录任务状态变化。

## 使用指南

### 窗口与文本

- 鼠标左键拖拽可移动悬浮窗口。
- 双击任务文本弹出输入框即可修改内容；若当前处于“暂无任务”状态，确认后会自动开始任务。
- 按下 `Esc` 键或在托盘菜单中选择“隐藏窗口”可最小化到托盘。

### 任务管理

| 操作入口 | 描述 |
| --- | --- |
| 右键窗口 / 托盘 → **开始任务** | 输入任务名称并开始计时，文字变为红色。 |
| 右键 / 托盘 → **暂停任务** | 文字变蓝，并在前缀显示“暂停中”，托盘/菜单自动改为“继续任务”。 |
| 右键 / 托盘 → **继续任务** | 继续计时，文字恢复为红色。 |
| 右键 / 托盘 → **终止任务** | 文本显示“暂无任务”，颜色恢复为白色。 |
| 右键 / 托盘 → **查看任务历史** | 打开历史窗口，按日期查看当日所有任务事件。 |

> 历史窗口会展示发生时间、事件类型（已开始 / 已暂停 / 已继续 / 已终止）以及对应的任务标题。

### 设置面板

托盘或右键菜单选择 **编辑任务...** 即可打开设置对话框，支持配置：

- 当前任务文本
- 字体名称、字号（8 – 96）
- 文本颜色、描边颜色（`#RRGGBB`）
- 透明度（0.2 – 1.0）
- 界面语言（中文 / English）
- 时间表管理（按钮“管理时间表...” 会打开独立面板）

保存后设置立即生效，并写入 `config.json`。

### 时间表与自动锁机

- 在设置窗口点击 **管理时间表...** 可创建多个时间段（每日重复），例如午餐 12:00-13:00、晚餐 18:30-19:00 等。
- 支持新增、编辑、删除时间段；所有时间采用 24 小时制 `HH:MM`。
- 到达指定时间范围后，程序会调用系统锁屏（仅限 Windows），每天每个时间段只触发一次。
- 若锁屏失败（例如权限不足），会弹出提示信息。

### 历史记录

任务状态每次变化都会写入 `task_history.json`。在“查看任务历史”窗口中可：

- 通过下拉框选择日期
- 查看当天所有事件的发生时间、类型与任务标题
- 若当天无记录，会显示提示文本

## 项目结构

```
attention/
├── attention/
│   ├── __init__.py      # 暴露 TaskApp、TaskConfig、CONFIG_FILE
│   ├── config.py        # 配置模型、校验与读取
│   ├── constants.py     # 默认常量与路径定义
│   ├── history.py       # 任务历史的读写操作
│   ├── i18n.py          # 多语言字典与翻译工具
│   └── ui.py            # Tkinter 界面与核心业务逻辑
├── floating_task.py     # CLI 入口，可传递参数覆盖配置
├── main.py              # 默认启动入口（调用 floating_task）
├── config.json          # 运行时生成的用户配置
├── task_history.json    # 运行时生成的任务历史
└── README.md
```

## 常见问题

1. **窗口透明但无法拖动？**  
   请确认鼠标按在文本区域；透明区域无法捕获拖动事件。

2. **托盘图标未出现？**  
   Tkinter + pystray 在部分系统上需要数秒初始化；若长时间无响应，可退出后重新启动。

3. **历史窗口弹出 “bad screen distance” 错误？**  
   该问题已在最新版本修复，请更新代码并重新运行。

4. **如何清空历史记录？**  
   退出程序后删除或清空 `task_history.json` 即可。

5. **自动锁机没有生效？**  
   确认系统为 Windows，且当前账号有权限调用 `LockWorkStation`。如多次失败，界面会弹出提示。

## 贡献与反馈

欢迎通过 Issue / Pull Request 提交 Bug、建议或功能改进。如果遇到问题，请附上日志与复现步骤，便于快速定位。

## 许可证

请根据项目实际情况补充（例如 MIT、Apache-2.0 等）。若尚未指定，请在此处说明。
